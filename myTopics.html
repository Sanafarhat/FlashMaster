<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlashMaster - My Topics</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="myTopics.css">

</head>
<body>
    <div class="stars" id="stars"></div>

    <!-- <nav class="navbar">
    <div class="container1">
      <div class="brand"><strong>FlashMaster</strong></div>
      <div class="menubar" onclick="toggleMenu()">â˜°</div>
      <ul class="nav-links" id="navMenu">
        <li><a href="HomePage.html">Home</a></li>
        <li><a href="modules.html">Modules</a></li>
        <!-- CREATE DROPDOWN 
        <li class="create-dropdown" onclick="toggleCreate(event)">
          <a href="javascript:void(0)">Create</a>
          <ul class="dropdown-menu" id="createDropdown">
            <li><a href="create.html">Add Topic</a></li>
            <li><a href="addCard.html">Add Cards</a></li>
          </ul>
        </li>

        <li><a href="progress.html">To-do List</a></li>

         USER DROPDOWN 
        <li class="user-dropdown" onclick="toggleDropdown(event)">
          <i class="fa-solid fa-circle-user user-icon"></i>
          <ul class="dropdown-menu" id="dropdownMenu">
            <li><a href="myTopics.html">My Topics</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="signup.html">Add Account</a></li>
            <li><a href="logout.html">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </nav> -->

        <div class="page-header">
            <h1>My Flashcard Topics</h1>
            <p>Your curated collection of knowledge!</p>
        </div>

        <div class="topics-display-area">
            <div id="topicsContainer" class="topic-grid">
            </div>
            <p id="noTopicsMessage" class="no-topics-message" style="display: none;">
                You haven't created any topics yet. Go to "Create" to get started!
            </p>
        </div>
    </div>
    
    <script>
        // Starfield background generation
        const stars = document.getElementById("stars");
        for (let i = 0; i < 100; i++) {
            const star = document.createElement("div");
            star.classList.add("star");
            star.style.top = `${Math.random() * 100}vh`;
            star.style.left = `${Math.random() * 100}vw`;
            star.style.animationDuration = `${Math.random() * 3 + 2}s`;
            stars.appendChild(star);
        }

        // --- Navbar Dropdown Toggles (consistent across pages) ---
        function toggleMenu() {
            document.getElementById("navMenu").classList.toggle("show");
            document.getElementById("createDropdownMenu").classList.remove("show");
            document.getElementById("userDropdownMenu").classList.remove("show");
        }

        function toggleCreateDropdown(event) {
            event.stopPropagation();
            const createDropdown = document.getElementById("createDropdownMenu");
            createDropdown.classList.toggle("show");
            document.getElementById("userDropdownMenu").classList.remove("show");
        }

        function toggleUserDropdown(event) {
            event.stopPropagation();
            const userDropdown = document.getElementById("userDropdownMenu");
            userDropdown.classList.toggle("show");
            document.getElementById("createDropdownMenu").classList.remove("show");
        }

        document.addEventListener("click", function (e) {
            const createDropdown = document.getElementById("createDropdownMenu");
            const createDropdownParent = document.querySelector(".create-dropdown");

            const userDropdown = document.getElementById("userDropdownMenu");
            const userDropdownParent = document.querySelector(".user-dropdown");

            if (createDropdown && !createDropdownParent.contains(e.target)) {
                createDropdown.classList.remove("show");
            }
            if (userDropdown && !userDropdownParent.contains(e.target)) {
                userDropdown.classList.remove("show");
            }

            const navMenu = document.getElementById('navMenu');
            const menubar = document.querySelector('.menubar');
            if (navMenu.classList.contains('show') && !navMenu.contains(e.target) && !menubar.contains(e.target)) {
                navMenu.classList.remove('show');
            }
        });


        // --- Page Specific JavaScript for My Topics ---
        document.addEventListener("DOMContentLoaded", () => {
            const topicsContainer = document.getElementById("topicsContainer");
            const noTopicsMessage = document.getElementById("noTopicsMessage");

            function loadAndDisplayTopics() {
                let allTopics = JSON.parse(localStorage.getItem('flashmaster_custom_topics')) || [];

                topicsContainer.innerHTML = '';

                if (allTopics.length === 0) {
                    noTopicsMessage.style.display = 'block';
                    return;
                } else {
                    noTopicsMessage.style.display = 'none';
                }

                allTopics.sort((a, b) => new Date(b.lastModified || b.id) - new Date(a.lastModified || a.id));

                allTopics.forEach(topic => {
                    const topicCard = document.createElement("div");
                    topicCard.classList.add("topic-card");
                    
                    const dateValue = topic.lastModified || topic.id;
                    const date = new Date(dateValue);
                    const formattedDate = date.toLocaleString('en-US', { 
                        year: 'numeric', month: 'short', day: 'numeric', 
                        hour: '2-digit', minute: '2-digit', hour12: true 
                    });

                    topicCard.innerHTML = `
                        <h3>${topic.topicName}</h3>
                        <p>${topic.cards.length} Flashcards</p>
                        <p>Last Modified: ${formattedDate === 'Invalid Date' ? 'N/A' : formattedDate}</p>
                        <div class="topic-actions">
                            <button class="view-btn" data-topic-id="${topic.id}">View Cards</button>
                            <button class="edit-btn" data-topic-id="${topic.id}">Edit Topic</button>
                            <button class="delete-btn" data-topic-id="${topic.id}">Delete</button>
                        </div>
                    `;
                    topicsContainer.appendChild(topicCard);
                });

                topicsContainer.addEventListener('click', (event) => {
                    const target = event.target;
                    if (target.tagName === 'BUTTON' && target.dataset.topicId) {
                        const topicId = parseInt(target.dataset.topicId, 10);
                        if (isNaN(topicId)) {
                            console.error("Invalid topic ID from button:", target.dataset.topicId);
                            return;
                        }

                        if (target.classList.contains('view-btn')) {
                            viewCards(topicId);
                        } else if (target.classList.contains('edit-btn')) {
                            editTopic(topicId);
                        } else if (target.classList.contains('delete-btn')) {
                            deleteTopic(topicId);
                        }
                    }
                });
            }

            function viewCards(topicId) {
                console.log(`Attempting to view cards for topic ID: ${topicId}`);
                // Redirect to the new viewCards page, passing the topic ID
                window.location.href = `viewCards.html?topicId=${topicId}`;
            }

            function editTopic(topicId) {
                console.log(`Attempting to edit topic ID: ${topicId}`);
                window.location.href = `create.html?topicId=${topicId}`;
            }

            function deleteTopic(topicId) {
                if (confirm("Are you sure you want to delete this topic and all its flashcards? This action cannot be undone.")) {
                    let allTopics = JSON.parse(localStorage.getItem('flashmaster_custom_topics')) || [];
                    
                    const initialLength = allTopics.length; 
                    const updatedTopics = allTopics.filter(topic => topic.id !== topicId); 
                    
                    localStorage.setItem('flashmaster_custom_topics', JSON.stringify(updatedTopics));
                    
                    if (updatedTopics.length < initialLength) {
                        console.log(`Successfully deleted topic with ID: ${topicId}`);
                    } else {
                        console.warn(`Failed to find or delete topic with ID: ${topicId}. It might not exist. Current IDs in storage:`, allTopics.map(t => t.id));
                    }

                    loadAndDisplayTopics();
                    alert("Topic deleted successfully!");
                }
            }

            loadAndDisplayTopics();

            window.toggleMenu = toggleMenu;
            window.toggleCreateDropdown = toggleCreateDropdown;
            window.toggleUserDropdown = toggleUserDropdown;
        });
    </script>
    <!-- <script src="myTopics.js"></script> -->
</body>
</html>